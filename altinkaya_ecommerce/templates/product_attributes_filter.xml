<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Filter out passive attributes -->
    <template id="product_attributes_filter_active_products"
              inherit_id="website_sale.products_attributes"
              name="Filter attributes by product">

        <xpath expr="//form[@class='js_attributes position-relative mb-2']/input[@name='search']"
               position="before">
            <t t-set="product_attr_vals"
               t-value="products.mapped('attribute_line_ids.value_ids')"/>
        </xpath>

        <xpath expr="//div[@class='accordion-item nav-item mb-1']"
               position="replace">
            <div class="accordion-item nav-item mb-1"
                 t-if="any(v in product_attr_vals for v in a.value_ids) and a.value_ids and len(a.value_ids) &gt; 1">
                <h6 class="mb-3">
                    <b class="o_products_attributes_title d-none d-lg-block"
                       t-field="a.name"/>
                </h6>
                <div t-attf-id="o_products_attributes_{{a.id}}" class="">
                    <t t-if="a.display_type == 'select'">
                        <select class="form-select css_attribute_select mb-2"
                                name="attrib">
                            <option value="" selected="true">-</option>
                            <t t-foreach="a.value_ids.filtered(lambda v: v in product_attr_vals)"
                               t-as="v">
                                <option t-att-value="'%s-%s' % (a.id,v.id)"
                                        t-esc="v.name"
                                        t-att-selected="v.id in attrib_set"/>
                            </t>
                        </select>
                    </t>
                    <t t-if="a.display_type == 'radio' or a.display_type == 'pills'">
                        <div class="flex-column mb-3">
                            <t t-foreach="a.value_ids.filtered(lambda v: v in product_attr_vals)"
                               t-as="v">
                                <div class="form-check mb-1">
                                    <input type="checkbox" name="attrib"
                                           class="form-check-input"
                                           t-att-id="'%s-%s' % (a.id,v.id)"
                                           t-att-value="'%s-%s' % (a.id,v.id)"
                                           t-att-checked="'checked' if v.id in attrib_set else None"/>
                                    <label class="form-check-label fw-normal"
                                           t-att-for="'%s-%s' % (a.id,v.id)"
                                           t-field="v.name"/>
                                </div>
                            </t>
                        </div>
                    </t>
                    <div t-if="a.display_type == 'color'" class="mb-3">
                        <t t-foreach="a.value_ids.filtered(lambda v: v in product_attr_vals)"
                           t-as="v">
                            <label t-attf-style="background-color:#{v.html_color or v.name}"
                                   t-attf-class="css_attribute_color mb-1 #{'active' if v.id in attrib_set else ''}">
                                <input type="checkbox" name="attrib"
                                       t-att-value="'%s-%s' % (a.id,v.id)"
                                       t-att-checked="'checked' if v.id in attrib_set else None"
                                       t-att-title="v.name"/>
                            </label>
                        </t>
                    </div>
                </div>
            </div>
        </xpath>

    </template>
</odoo>